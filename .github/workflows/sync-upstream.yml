name: Sync Fork with Upstream

on:
  schedule:
    - cron: '0 0 * * *'
  workflow_dispatch:

jobs:
  sync:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout fork
        uses: actions/checkout@v4
        with:
          ref: dev-chirag
          fetch-depth: 0

      - name: Fetch upstream and sync into problems/
        run: |
          git clone --depth 1 https://github.com/snehasishroy/leetcode-companywise-interview-questions.git /tmp/upstream

          mkdir -p problems

          rsync -a --delete \
            --exclude='.git' \
            --exclude='.github' \
            --exclude='README.md' \
            --exclude='target' \
            /tmp/upstream/ problems/

          rm -rf /tmp/upstream

      - name: Commit and push if changed
        run: |
          git config user.name "Chiragmodi1247"
          git config user.email "mchirag1247@gmail.com"
          git add problems/
          if git diff --cached --quiet; then
            echo "No changes from upstream"
          else
            git commit -m "Sync upstream problem data $(date -u +%Y-%m-%d) #commit_by_cursor"
            git push origin dev-chirag
          fi
